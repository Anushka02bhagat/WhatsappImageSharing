<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Sender</title>
    <style>
        /* ... (keep previous styles) ... */
        #phone {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #25D366;
            border-radius: 5px;
            font-size: 16px;
        }
        .number-note {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>Image Sender</h1>
    
    <div class="controls">
        <input type="tel" id="phone" 
               placeholder="Example: 911234567890 (with country code)" 
               pattern="[0-9]{10,15}" 
               required>
        <p class="number-note">Enter full number with country code (no + sign)</p>
    </div>
    
    <!-- ... (rest of your existing HTML) ... -->

    <script>
        // ... (keep previous JavaScript) ...

        // Modified send function
        sendBtn.addEventListener('click', () => {
            if (!imageBlob || !phoneInput.value) {
                alert("Please capture an image and enter a valid phone number");
                return;
            }
            
            // Clean phone number (remove all non-digits)
            const phoneNumber = phoneInput.value.replace(/\D/g, '');
            
            // Validate number length (minimum 10 digits including country code)
            if (phoneNumber.length < 10 || phoneNumber.length > 15) {
                alert("Please enter a valid number with country code (10-15 digits)");
                return;
            }

            // Create temporary file for sharing
            const file = new File([imageBlob], 'image.jpg', { type: 'image/jpeg' });
            const fileUrl = URL.createObjectURL(file);
            
            // Android devices can share directly
            if (navigator.share && /Android/i.test(navigator.userAgent)) {
                navigator.share({
                    title: 'Photo',
                    text: 'Sent from Image Sender',
                    files: [file]
                }).catch(err => {
                    console.log('Sharing failed, falling back to WhatsApp:', err);
                    openWhatsApp(phoneNumber, fileUrl);
                });
            } 
            // iOS and desktop devices
            else {
                openWhatsApp(phoneNumber, fileUrl);
            }
        });

        function openWhatsApp(phoneNumber, imageUrl) {
            // Create a temporary link to force download (for better WhatsApp compatibility)
            const tempLink = document.createElement('a');
            tempLink.href = imageUrl;
            tempLink.download = 'image_to_share.jpg';
            document.body.appendChild(tempLink);
            tempLink.click();
            document.body.removeChild(tempLink);
            
            // Open WhatsApp with the number
            window.open(`https://wa.me/${phoneNumber}?text=Here's%20an%20image`, '_blank');
            
            // Note: On some devices, you'll need to manually attach the downloaded image
            alert("If image didn't attach automatically:\n1. Open WhatsApp\n2. Select the entered number\n3. Attach the downloaded image");
        }

        // ... (rest of your JavaScript) ...
    </script>
</body>
</html>
